(()=>{"use strict";({156:function(){var t,o,e,i=this&&this.__classPrivateFieldGet||function(t,o,e,i){if("a"===e&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof o?t!==o||!i:!o.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?i:"a"===e?i.call(t):i?i.value:o.get(t)},n=this&&this.__classPrivateFieldSet||function(t,o,e,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof o?t!==o||!n:!o.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(t,e):n?n.value=e:o.set(t,e),e};function s(t,o){return Math.random()*(o-t)+t}function r(t){return t<0?0:t>255?255:t}function u(t){const o=t/100;return[o<=66?255:r(329.698727446*Math.pow(o-60,-.1332047592)),r(o<=66?99.4708025861*Math.log(o)-161.1195681661:288.1221695283*Math.pow(o-60,-.0755148492)),o>=66?255:o<=19?0:r(138.5177312231*Math.log(o-10)-305.0447927307)]}class h{constructor(t,o){if(t[0]>o[0]||t[1]>o[1]||t[2]>o[2])throw new Error(`Invalid range (received ${t}, ${o})`);this.lowerBound=t,this.upperBound=o}randPoint(){return[s(this.lowerBound[0],this.upperBound[0]),s(this.lowerBound[1],this.upperBound[1]),s(this.lowerBound[2],this.upperBound[2])]}volume(){return(this.upperBound[0]-this.lowerBound[0])*(this.upperBound[1]-this.lowerBound[1])*(this.upperBound[2]-this.lowerBound[2])}contains(t){return t[0]>=this.lowerBound[0]&&t[0]<=this.upperBound[0]&&t[1]>=this.lowerBound[1]&&t[1]<=this.upperBound[1]&&t[2]>=this.lowerBound[2]&&t[2]<=this.upperBound[2]}}class a{constructor(t){this.temperature=s(a.MIN_TEMP,a.MAX_TEMP),this.luminosity=s(0,a.MAX_LUMINOSITY),this.position=t.randPoint()}}a.MAX_LUMINOSITY=4,a.MIN_TEMP=2e3,a.MAX_TEMP=3e4;class d{constructor(t,o){this.size=t,this.stellarDensity=o,this.stars=[],this.populateStars(this.size)}populateStars(t){const o=this.stellarDensity*t.volume(),e=o%1,i=0===e?o:Math.random()<e?Math.floor(o):Math.ceil(o);console.log("Started generating stars:",i);for(let o=0;o<i;o++)this.stars.push(new a(t))}translateY(t){for(const o of this.stars)o.position[1]+=t;this.cleanStars(),this.populateStars(new h(this.size.lowerBound,[this.size.upperBound[0],this.size.lowerBound[1]+t,this.size.upperBound[2]]))}cleanStars(){this.stars=this.stars.filter((t=>this.size.contains(t.position)))}resize(t){t.upperBound[0]>this.size.upperBound[0]&&this.populateStars(new h([this.size.upperBound[0],this.size.lowerBound[1],this.size.lowerBound[2]],[t.upperBound[0],this.size.upperBound[1],this.size.upperBound[2]])),t.lowerBound[0]<this.size.lowerBound[0]&&this.populateStars(new h([t.lowerBound[0],this.size.lowerBound[1],this.size.lowerBound[2]],[this.size.lowerBound[0],this.size.upperBound[1],this.size.upperBound[2]])),t.upperBound[1]>this.size.upperBound[1]&&this.populateStars(new h([t.lowerBound[0],this.size.upperBound[1],this.size.lowerBound[2]],[t.upperBound[0],t.upperBound[1],this.size.upperBound[2]])),t.lowerBound[1]<this.size.lowerBound[1]&&this.populateStars(new h([t.lowerBound[0],t.lowerBound[1],this.size.lowerBound[2]],[t.upperBound[0],this.size.lowerBound[1],this.size.upperBound[2]])),t.upperBound[2]>this.size.upperBound[2]&&this.populateStars(new h([t.lowerBound[0],t.lowerBound[1],this.size.upperBound[2]],[t.upperBound[0],t.lowerBound[1],t.upperBound[2]])),t.lowerBound[2]<this.size.lowerBound[2]&&this.populateStars(new h([t.lowerBound[0],t.lowerBound[1],t.lowerBound[2]],[t.upperBound[0],t.lowerBound[1],this.size.lowerBound[2]])),this.size=t,this.cleanStars()}}class l{constructor(n,s,r,u){t.add(this),o.set(this,void 0),this.location=[0,0,-n],this.depth=s,this.setWindow(u),this.universe=new d(i(this,t,"m",e).call(this),r)}setWindow(s){var r,u,a;s[0]===(null===(r=i(this,o,"f"))||void 0===r?void 0:r.upperBound[0])&&s[1]===(null===(u=i(this,o,"f"))||void 0===u?void 0:u.upperBound[1])||(n(this,o,new h([-s[0],-s[1],0],[s[0],s[1],0]),"f"),null===(a=this.universe)||void 0===a||a.resize(i(this,t,"m",e).call(this)))}flatten(){const t=[];for(const e of this.universe.stars){const n=[(e.position[0]-this.location[0])/(e.position[2]-this.location[2])*-this.location[2],(e.position[1]-this.location[1])/(e.position[2]-this.location[2])*-this.location[2]],s=e.luminosity/Math.pow(e.position[2]-this.location[2],2),r=Math.sqrt(s);if(n[0]<i(this,o,"f").lowerBound[0]-r||n[0]>i(this,o,"f").upperBound[0]+r||n[1]<i(this,o,"f").lowerBound[1]-r||n[1]>i(this,o,"f").upperBound[1]+r)continue;const h=u(e.temperature),a=n[0]-i(this,o,"f").lowerBound[0],d=n[1]-i(this,o,"f").lowerBound[1],[l,p]=r>=1?[r,1]:[1,s];t.push({radius:l,position:[a,d],color:h,opacity:p})}return t}}function p(t,o){const e=performance.now(),i=o(),n=performance.now()-e;return console.log(t,n),i}o=new WeakMap,t=new WeakSet,e=function(){return new h([(i(this,o,"f").lowerBound[0]-this.location[0])/(i(this,o,"f").lowerBound[2]-this.location[2])*(this.depth-this.location[2]),(i(this,o,"f").lowerBound[1]-this.location[1])/(i(this,o,"f").lowerBound[2]-this.location[2])*(this.depth-this.location[2]),0],[(i(this,o,"f").upperBound[0]-this.location[0])/(i(this,o,"f").upperBound[2]-this.location[2])*(this.depth-this.location[2]),(i(this,o,"f").upperBound[1]-this.location[1])/(i(this,o,"f").upperBound[2]-this.location[2])*(this.depth-this.location[2]),this.depth])},document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("background-canvas");t.width=window.innerWidth,t.height=window.innerHeight;const o=t.getContext("2d");if(null===o)throw new Error("2d context not supported");const e=new l(1,3,1e-4,[t.width/2,t.height/2]);let i=performance.now();!function n(){const s=performance.now(),r=s-i;i=s,console.log("Time since last frame:",r),t.width!==window.innerWidth&&(t.width=window.innerWidth),t.height!==window.innerHeight&&(t.height=window.innerHeight),e.setWindow([t.width/2,t.height/2]),p("Translate:",(()=>e.universe.translateY(.02*r)));const u=p("Flatten:",(()=>e.flatten()));p("Draw:",(()=>{o.clearRect(0,0,t.width,t.height),u.forEach((t=>function(t,o){t.fillStyle=`rgb(${o.color.join(" ")} / ${100*o.opacity}%)`,t.beginPath(),t.arc(o.position[0],o.position[1],o.radius,0,2*Math.PI),t.fill()}(o,t)))})),requestAnimationFrame(n)}()}))}})[156]()})();